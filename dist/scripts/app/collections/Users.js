define(["jquery","underscore","parse","backbone"],function(e,t,a,r){return a.Collection.extend({model:a.User,initialize:function(){this.query=new a.Query(this.model)},comparator:function(e,a){var r,n;return t.has(this,"sortbycreated")?(r=a.createdAt,n=e.createdAt):(r=e.get("paidOn"),n=a.get("paidOn")),t.gt(r,n)?1:t.lt(r,n)?-1:0},fetch:function(e){var r=this;e=e||{};t.defaults(e,{add:!0,update:!0,select:["id","username","realname","email"]});var n=new a.Query(r.model);if(e.update&&0!=r.models.length){var d=t.map(r.models,"createdAt");d=t.sortBy(d),n.greaterThan("createdAt",t.last(d))}n.select.apply(n,e.select);var i=[];return n.each(function(e){i.push(e)}).then(function(){return e.add?t.each(i,function(e){r.add(e)}):r.reset(i),a.Promise.as(r)})}})});