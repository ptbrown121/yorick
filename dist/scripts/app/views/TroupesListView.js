define(["underscore","jquery","backbone","text!../templates/troupes-list.html","parse","../collections/Troupes","../helpers/PromiseFailReport"],function(e,t,i,r,n,o,l){return i.View.extend({initialize:function(){e.bindAll(this,"render","register"),this.collection=new o,this.listenTo(this.collection,"add remove reset",this.render)},register:function(t,i){var r=this;if(t=t||"#troupe/<%= troupe_id %>",e.eq(t,r.base_url)||(r.base_url=t,!0),i=i||function(){},!e.eq(i,r.filter)){var o=[],s=new n.Query("Troupe");return s.select("id","name","portrait","shortdescription","location","staffemail"),s.include("portrait"),i(s),s.each(function(e){o.push(e)}).then(function(){r.collection.reset(o)}).fail(l)}return n.Promise.as([])},events:{"click .troupe-listing":"clicked"},clicked:function(i){i.preventDefault(),t.mobile.loading("show");var r=t(i.currentTarget).attr("backendId"),n=e.template(this.base_url)({troupe_id:r});window.location.hash=n},render:function(){return this.template=e.template(r)({collection:this.collection.models}),this.$el.find("div[role='troupe-list']").html(this.template),this.$el.enhanceWithin(),this}})});