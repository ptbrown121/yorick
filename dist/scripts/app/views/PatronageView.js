define(["jquery","backbone","marionette","backform","bootstrap-datepicker","moment","../helpers/UserWreqr"],function(e,t,n,s,a,r,o){return t.View.extend({initialize:function(t){var n=this;n.options=t;var a="MM/DD/YYYY",i="mm/dd/yyyy",l=n.model.clone();l.has("owner")?l.set("owner",l.get("owner").id):n.isNew=!0,l.has("paidOn")&&l.set("paidOn",r(l.get("paidOn")).format(a)),l.has("expiresOn")&&l.set("expiresOn",r(l.get("expiresOn")).format(a));var d=o.channel.reqres.request("all").map(function(e){return{label:e.get("username")+" "+e.get("realname")+" "+e.get("email"),value:e.id}});d.unshift({label:"Invalid",value:""}),n.form=new s.Form({el:n.$el,model:l,fields:[{name:"owner",label:"Owner",control:"select",options:d},{name:"paidOn",label:"Paid on",control:"datepicker",type:"text",options:{autoclose:!0,format:i}},{name:"expiresOn",label:"Expires on",control:"datepicker",type:"text",options:{autoclose:!0,format:i}},{name:"submit",control:"button",label:"Save Changes"}],events:{submit:function(t){var s=this;t.preventDefault(),s.fields.at(3).set({status:"",message:""}),s.model.errorModel.clear(),n.model.set({paidOn:r(s.model.get("paidOn"),a).toDate(),expiresOn:r(s.model.get("expiresOn"),a).toDate(),owner:new Parse.User({id:s.model.get("owner")})});var o=new Parse.ACL;o.setPublicReadAccess(!0),o.setPublicWriteAccess(!1),o.setRoleReadAccess("Administrator",!0),o.setRoleWriteAccess("Administrator",!0),n.model.setACL(o),n.model.save().then(function(){s.fields.at(3).set({status:"success",message:"Save completed"}),_.defer(function(){e("body").enhanceWithin()})}).fail(function(e){s.model.errorModel.set("owner",_.escape(e.message))})}}})},tagName:"form",render:function(){return this.form.render(),this.$el.enhanceWithin(),this}})});