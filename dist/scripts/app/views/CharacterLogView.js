define(["jquery","backbone","moment","../models/VampireChange","../collections/VampireChangeCollection","../models/Vampire"],function(e,t,n,a,i,c){return t.View.extend({initialize:function(){var e=this;this.collection=new i,e.listenTo(e.collection,"add",e.render),e.listenTo(e.collection,"reset",e.render),e.start=0,e.changeBy=10},register:function(e,t,n){var a=this,i=!1;return t=_.parseInt(t),n=_.parseInt(n),t!=a.start&&(a.start=t,i=!0),n!=a.changeBy&&(a.changeBy=n,i=!0),e!==a.character&&(a.character&&a.stopListening(a.character),a.character=e,a.listenTo(a.character,"change:change_count",a.update_collection_query_and_fetch),i=!0),i&&a.update_collection_query_and_fetch(),a},events:{"click .previous":"previous","click .next":"next","click .hackupdateowner":"hackupdateowner","click .hackdeleteoriginal":"hackdeleteoriginal"},previous:function(){var t=this.start-this.changeBy;this.start=_.max([0,t]),window.location.hash="#character/"+this.character.id+"/log/"+this.start+"/10",e.mobile.loading("show"),this.update_collection_query_and_fetch().then(function(){e.mobile.loading("hide")})},next:function(){this.start+=this.changeBy,window.location.hash="#character/"+this.character.id+"/log/"+this.start+"/10",e.mobile.loading("show"),this.update_collection_query_and_fetch().then(function(){e.mobile.loading("hide")})},hackupdateowner:function(){var e=[],t=n(new Date("Sat Jun 18 2016 09:27:53 GMT -400 (Eastern Daylight Time)"));_.forEachRight(this.collection.models,function(a,i){n(a.createdAt).isSame(t,"day")&&e.push(a)}),this.collection.reset(e),c.get_character("RT8FXNL8P2").then(function(t){return _.each(e,function(e){e.set("owner",t)}),Parse.Object.saveAll(e)}).then(function(){console.log("Saved")}).fail(function(e){console.error(e.message)})},hackdeleteoriginal:function(){var e=[],t=n(new Date("Sat Jun 18 2016 09:27:53 GMT -400 (Eastern Daylight Time)"));_.forEachRight(this.collection.models,function(a,i){n(a.createdAt).isSame(t,"day")&&e.push(a)}),this.collection.reset(e),Parse.Object.destroyAll(e).then(function(){console.log("Deleted")}).fail(function(e){console.error(e.message)})},update_collection_query_and_fetch:function(){var e=this,t=new Parse.Query(a);return t.equalTo("owner",e.character).addDescending("createdAt"),t.skip(e.start),t.limit(e.changeBy),e.collection.query=t,e.collection.fetch({reset:!0})},format_entry:function(e,t){if(e.get(t))return e.get(t);var a=e[t];return _.isDate(a)?n(a).format("lll"):a},render:function(){return this.template=_.template(e("script#characterLogView").html())({character:this.character,logs:this.collection.models,format_entry:this.format_entry}),this.$el.find("div[role='main']").html(this.template),this.$el.enhanceWithin(),this}})});