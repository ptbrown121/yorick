define(["jquery","underscore","parse","backbone","marionette","../collections/Users"],function(e,r,n,o,t,a){return new(o.Model.extend({initialize:function(){var e=this;e.channel=o.Wreqr.radio.channel("role"),e.roles=new o.Collection,o.Wreqr.radio.reqres.setHandler("role","get",function(r){return e.roles.get(r)}),o.Wreqr.radio.reqres.setHandler("role","all",function(){return e.roles})},get_current_roles:function(){var e=this;return e._updateRoleWrapper=e._updateRoleWrapper||n.Promise.as(),e._updateRoleWrapper=e._updateRoleWrapper.always(function(){return r.eq(e.last_user_id,n.User.current().id)?n.Promise.as():(e.last_user_id=n.User.current().id,new n.Query(n.Role).each(function(r){var o=r.getUsers().query();return o.equalTo("objectId",n.User.current().id),o.each(function(n){e.roles.add(r)}).fail(function(e){console.log("Failed in promise for "+r.get("name"))})}))}),e._updateRoleWrapper}}))});