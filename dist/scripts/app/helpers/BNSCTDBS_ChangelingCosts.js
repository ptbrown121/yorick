define(["underscore","parse","../collections/BNSCTDBS_KithRules"],function(t,e,n){return e.Object.extend("ChangelingBetaSliceCosts",{initialize:function(){var t=this;return t.KithRules=new n,t.KithRules.fetch().then(function(){return e.Promise.as(t)})},get_arts_affinities:function(e){var n=this.KithRules.get_arts_affinities(e),_=t.map(e.get("ctdbs_arts_affinities_links"),"attributes.name");return n=[].concat(n,_)},get_arts_affinities_for_kith:function(t){return this.KithRules.get_arts_affinities_for_kith(t)},art_is_affinity:function(e,n){var _=this.get_arts_affinities(e);return[]!=_&&t.any(_,function(e){return!!t.eq(e,n.get_base_name())||!!t.eq(e,n.get("name"))})},get_cost_table:function(e){return t.map(t.range(1,10),function(t){return t*e})},get_cost_on_table:function(e,n){return t.chain(e).take(n).sum().value()},get_trait_cost_on_table:function(t,e){var n=e.get("value"),_=e.get("free_value")||0;return this.get_cost_on_table(t,n)-this.get_cost_on_table(t,_)},get_generation_cost_table:function(){var t=this.get_cost_table(2);return t[0]=1,t},calculate_trait_cost:function(t,e){var n=this,_=e.get("category"),i=(e.get("name"),e.get("value")-(e.get("free_value")||0));if("attributes"==_)return 3*i;if("ctdbs_arts"==_)return n.art_is_affinity(t,e)?n.get_trait_cost_on_table(n.get_cost_table(4),e):n.get_trait_cost_on_table(n.get_cost_table(6),e);if("ctdbs_merits"==_)return i;if("ctdbs_flaws"==_)return-1*i;if("backgrounds"==_)return n.get_trait_cost_on_table(n.get_cost_table(2),e);var a,r=t.seeming();if("skills"==_)return a=r<3?n.get_cost_table(1):n.get_cost_table(2),n.get_trait_cost_on_table(a,e);if("ctdbs_realms"==_){var s=t.realms().length;return n.get_cost_on_table(n.get_cost_table(8),s)}return 0}})});