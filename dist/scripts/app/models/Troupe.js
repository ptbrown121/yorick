define(["jquery","parse"],function(t,e){return e.Object.extend("Troupe",{initialize:function(t){var n=new e.ACL;n.setPublicReadAccess(!0),n.setPublicWriteAccess(!1),n.setRoleReadAccess("Administrator",!0),n.setRoleWriteAccess("Administrator",!0),this.setACL(n),this.title_options=["LST","AST","Narrator"]},get_staff:function(){var t=[];return e.Promise.when(this.get_roles()).then(function(n){var r=_.map(n,function(e,n){return e.getUsers().query().each(function(e){e.set("role",n),t.push(e)})});return e.Promise.when(r)}).then(function(){return e.Promise.as(t)})},get_roles:function(){var t=this,n={},r=_.map(t.title_options,function(r){var i=new e.Query(e.Role);return i.equalTo("name",r+"_"+t.id),i.first().then(function(t){n[r]=t})});return e.Promise.when(r).then(function(){return e.Promise.as(n)})},get_generic_roles:function(){var t={},n=_.map(this.title_options,function(n){var r=new e.Query(e.Role);return r.equalTo("name",n),r.first().then(function(e){t[n]=e})});return e.Promise.when(n).then(function(){return e.Promise.as(t)})},get_thumbnail:function(t){var n=this;return n.get("portrait")?n.get("portrait").fetch().then(function(r){return console.log(n.get_thumbnail_sync(t)),e.Promise.as(r.get("thumb_"+t).url())}):e.Promise.as("head_skull.png")},get_thumbnail_sync:function(t){return _.result(this,"attributes.portrait.attributes.thumb_"+t+".url","head_skull.png")}})});